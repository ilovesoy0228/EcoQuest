<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
<title>Project Name</title>

<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap">
<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons+Round">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />

<style>
  .material-symbols-outlined{ font-variation-settings:'FILL' 0,'wght' 400,'GRAD' 0,'opsz' 24; }
</style>

<style>
  :root{
    --ui-scale:.93;
    --primary:#13ec6d;
    --bg:#f6f8f7;
    --card:#ffffff;
    --border:#e2e8e4;
    --shadow:#d1d9d4;

    --ink:#0f172a;
    --muted:#64748b;
    --muted-2:#94a3b8;

    --r-xl:26px;
    --r-lg:20px;
    --r-md:16px;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family:"Plus Jakarta Sans",sans-serif;
    background:var(--bg);
    color:var(--ink);
    min-height:100vh;
      overflow-x:hidden;
    zoom:var(--ui-scale);
}
  .app{ max-width:430px; margin:0 auto; padding-bottom:120px; }

  header{
    position:sticky;top:0;z-index:10;
    background:rgba(246,248,247,.85);
    backdrop-filter:blur(10px);
    padding:28px 20px 14px;
    border-bottom:1px solid rgba(15,23,42,.06);
  }
  header .row{display:flex;justify-content:space-between;align-items:flex-end}
  .rank{font-size:11px;font-weight:800;letter-spacing:2px;color:var(--primary)}
  .title{font-size:28px;font-weight:800;font-style:italic;margin:0}
  .lvl{
    font-size:11px;font-weight:800;
    background:rgba(19,236,109,.18);
    color:var(--primary);
    padding:4px 8px;border-radius:10px;margin-bottom:6px;text-align:right;
  }
  .xp-bar{width:90px;height:7px;background:rgba(15,23,42,.08);border-radius:999px;overflow:hidden}
  .xp-fill{height:100%;width:70%;background:var(--primary)}

  main{padding:16px 20px 32px;}

  .card{
    background:var(--card);
    border:2px solid var(--border);
    box-shadow:0 6px 0 -2px var(--shadow);
    border-radius:var(--r-md);
    padding:18px;
  }

  .featured{
    position:relative;
    background:var(--card);
    border:2px solid var(--border);
    border-radius:var(--r-lg);
    padding:18px;
    box-shadow:0 6px 0 -2px var(--shadow);
  }
  .badge{
    position:absolute;right:14px;top:14px;
    width:48px;height:48px;border-radius:999px;
    background:rgba(19,236,109,.18);
    color:var(--primary);
    display:flex;align-items:center;justify-content:center;
    border:2px solid rgba(19,236,109,.18);
  }
  .tags{display:flex;gap:6px;flex-wrap:wrap;margin-top:2px}
  .tag{ font-size:10px;font-weight:800;padding:4px 8px;border-radius:999px;text-transform:uppercase; }
  .tag.red{background:rgba(244,63,94,.12);color:#be123c}
  .tag.gold{background:rgba(19,236,109,.14);color:var(--primary)}
  .featured h3{margin:10px 0 6px;font-size:20px;font-weight:900}
  .featured p{margin:0;font-size:12px;color:var(--muted);font-weight:600}
  .featured .footer{
    display:flex;justify-content:space-between;align-items:center;gap:10px;
    margin-top:16px;padding-top:12px;border-top:1px solid rgba(15,23,42,.06);
  }
  .reward{display:flex;align-items:center;gap:6px;color:var(--primary);font-weight:900;font-size:12px}
  .btn{
    background:var(--primary);
    color:#0b1220;font-weight:900;border:0;
    padding:10px 14px;border-radius:999px;
    box-shadow:0 10px 20px rgba(19,236,109,.18);
    cursor:pointer;
    white-space:nowrap;
  }
  .btn:active{transform:translateY(1px)}

  .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:12px}
  .tile{
    background:var(--card);
    border:2px solid var(--border);
    box-shadow:0 6px 0 -2px var(--shadow);
    border-radius:var(--r-md);
    padding:14px;
    display:flex;flex-direction:column;gap:10px;
    min-height:140px;
  }
  .tile h4{margin:0;font-size:14px;font-weight:900;line-height:1.2}
  .tile p{margin:0;font-size:11px;color:var(--muted);font-weight:700}
  .icon{
    width:40px;height:40px;border-radius:999px;
    display:flex;align-items:center;justify-content:center;
    background:rgba(15,23,42,.06);
    color:var(--ink);
  }
  .pill{
    font-size:9px;font-weight:900;padding:3px 8px;border-radius:999px;letter-spacing:.08em;
  }
  .rp{display:flex;align-items:center;gap:6px;font-size:12px;font-weight:900;color:var(--primary);margin-top:auto}

  .easy .icon{background:rgba(19,236,109,.14);color:var(--primary)}
  .easy .pill{background:rgba(19,236,109,.14);color:var(--primary)}
  .med .icon{background:rgba(59,130,246,.12);color:#2563eb}
  .med .pill{background:rgba(59,130,246,.12);color:#2563eb}
  .amber .icon{background:rgba(245,158,11,.14);color:#ff8800}
  .amber .pill{background:rgba(245,158,11,.14);color:#ff8800}
  .purple .icon{background:rgba(139,92,246,.12);color:#7c3aed}
  .purple .pill{background:rgba(139,92,246,.12);color:#7c3aed}

  .locked{
    background:#f1f5f9;
    opacity:.7;
    position:relative;
  }
  .locked .lock{
    position:absolute;inset:0;
    display:flex;align-items:center;justify-content:center;
    pointer-events:none;
  }
  .locked .lock span{
    background:rgba(15,23,42,.85);color:white;border-radius:999px;padding:6px;
  }
  .empty{
    background:transparent;
    border:2px dashed rgba(15,23,42,.16);
    box-shadow:none;
    display:flex;align-items:center;justify-content:center;
    text-align:center;color:var(--muted-2);
  }

  nav{
    position:fixed;
    left:16px; right:16px; bottom:18px;
    max-width:430px;
    margin:0 auto;
    background:var(--card);
    border:2px solid var(--border);
    border-radius:999px;
    padding:10px 12px;
    box-shadow:0 18px 40px rgba(15,23,42,.12);
  }
  nav .bar{
    display:flex;
    align-items:center;
  }
  nav .bar a{
    flex:1;
    display:flex;
    justify-content:center;
    align-items:center;
    text-decoration:none;
    color:inherit;
  }
  nav button{
    width:44px;height:44px;
    background:none;border:0;
    border-radius:999px;
    display:flex;align-items:center;justify-content:center;
    color:rgba(15,23,42,.55);
    cursor:pointer;
    padding:0;
  }
  nav button span{font-size:22px}
  nav .fab{
    width:52px;height:52px;border-radius:999px;
    background:var(--primary);
    color:#0b1220;
    display:flex;align-items:center;justify-content:center;
    box-shadow:0 10px 20px rgba(19,236,109,.20);
  }
  a{text-decoration:none;color:inherit;}

  /* Proof overlay + sheet */
  .overlay{
    position:fixed; inset:0;
    background:rgba(15,23,42,.38);
    backdrop-filter: blur(2px);
    display:none;
    z-index:50;
  }
  .overlay.show{ display:block; }

  .sheet{
    position:fixed;
    left:16px; right:16px; bottom:18px;
    max-width:430px;
    margin:0 auto;
    background:var(--card);
    border:2px solid var(--border);
    border-radius:28px;
    box-shadow:0 24px 80px rgba(15,23,42,.28);
    padding:16px;
    transform: translateY(110%);
    transition: transform .22s ease;
    z-index:51;
  }
  .sheet.show{ transform: translateY(0); }

  .sheet .top{
    display:flex; align-items:flex-start; justify-content:space-between; gap:12px;
    margin-bottom:12px;
  }
  .sheet h3{
    margin:0;
    font-size:16px;
    font-weight:900;
    letter-spacing:.2px;
  }
  .sheet .sub{
    margin-top:4px;
    font-size:11px;
    color:var(--muted);
    font-weight:700;
    line-height:1.35;
  }
  .close{
    width:40px; height:40px;
    border-radius:999px;
    border:2px solid var(--border);
    background:rgba(15,23,42,.03);
    display:flex; align-items:center; justify-content:center;
    cursor:pointer;
  }
  .frame{
    background:rgba(15,23,42,.04);
    border:2px solid rgba(15,23,42,.06);
    border-radius:22px;
    padding:10px;
  }
  video{
    width:100%;
    border-radius:18px;
    display:block;
    background:#0b1220;
  }

  .slots{ margin-top:12px; display:grid; grid-template-columns:1fr 1fr; gap:10px; }

  /* --- FIX: prevent horizontal overflow on small screens --- */
  body{ overflow-x:hidden; }
  .slots{ grid-template-columns: minmax(0,1fr) minmax(0,1fr); }
  .slot{ min-width:0; }
  .actionsRow{ flex-wrap:wrap; }
  .actionsRow .ghost, .actionsRow .primary{ min-width:0; flex:1 1 0; }
  @media (max-width: 420px){
    .slots{ grid-template-columns: 1fr; }
  }
  .slot{
    border:2px solid var(--border);
    border-radius:20px;
    padding:10px;
    background:rgba(15,23,42,.02);
    display:flex;
    flex-direction:column;
    gap:8px;
    min-height:170px;
  }
  .slot .label{
    display:flex; align-items:center; justify-content:space-between; gap:8px;
  }
  .slot .label strong{ font-size:11px; letter-spacing:.12em; text-transform:uppercase; }
  .slot .status{ font-size:10px; font-weight:900; color:var(--muted-2); }
  .slot .status.ok{ color: var(--primary); }
  .thumb{
    width:100%;
    aspect-ratio: 4/3;
    border-radius:16px;
    background:rgba(15,23,42,.06);
    display:flex;
    align-items:center;
    justify-content:center;
    overflow:hidden;
  }
  .thumb img{
    width:100%; height:100%;
    object-fit:cover;
    display:none;
  }
  .thumb .ph{
    color:var(--muted-2);
    font-size:10px;
    font-weight:800;
    letter-spacing:.08em;
    text-transform:uppercase;
  }

  .actionsRow{ display:flex; gap:8px; }
  .ghost, .primary{
    flex:1;
    font-weight:900;
    padding:10px 12px;
    border-radius:999px;
    cursor:pointer;
    display:inline-flex;
    align-items:center;
    justify-content:center;
    gap:6px;
    user-select:none;
  }
  .ghost{
    border:2px solid var(--border);
    background:transparent;
    color:var(--ink);
  }
  .primary{
    background:var(--primary);
    border:0;
    color:#0b1220;
    box-shadow:0 10px 20px rgba(19,236,109,.20);
  }
  .primary:active,.ghost:active{ transform: translateY(1px); }

  .submitRow{ display:flex; gap:10px; margin-top:12px; }
  .submitRow .primary{ flex:1.2; }
  .submitRow .ghost{ flex:.8; }

  .hint{
    margin-top:8px;
    font-size:10px;
    color:var(--muted-2);
    font-weight:700;
    line-height:1.3;
  }
  .toast{
    margin-top:10px;
    display:none;
    border:2px solid rgba(19,236,109,.20);
    background:rgba(19,236,109,.12);
    border-radius:18px;
    padding:10px 12px;
    font-size:11px;
    font-weight:900;
    color:var(--primary);
  }
  .toast.show{ display:block; }

  input[type="file"]{ display:none; }

  /* Icon-only upload/capture buttons keep pill shape */
  .actionsRow .ghost, .actionsRow .primary{ justify-content:center; gap:0; }
</style>

</head>
<body>
  <div class="app">
    <header>
      <div class="row">
        <div>
          <div class="rank">Questboard</div>
          <h1 class="title">EcoQuest</h1>
        </div>
        <div style="text-align:right">
          <div class="lvl">LVL 14</div>
          <div class="xp-bar"><div class="xp-fill"></div></div>
        </div>
      </div>
    </header>

    <main>
      <div class="card">
        <h2 style="font-size:12px;font-weight:700;opacity:.6;text-transform:uppercase;margin:0 0 10px;">Daily Quest</h2>

        <section class="featured">
          <div class="badge"><span class="material-icons-round">emoji_events</span></div>

          <div class="tags">
            <span class="tag red">Hard Difficulty</span>
            <span class="tag gold">Time Limited</span>
          </div>

          <h3>Public Area Rescue</h3>
          <p>Clean a public spot (park corner, sidewalk section,<br> bus stop area) and document before/after results.</p>

          <div class="footer">
            <div class="reward">
              <span class="material-icons-round">stars</span>
              +200 XP
            </div>
            <button class="btn" id="acceptQuest">ACCEPT QUEST</button>
          </div>
        </section>

        <h2 style="font-size:12px;font-weight:700;opacity:.6;text-transform:uppercase;margin:20px 0 10px;">Open Contracts</h2>

        <div class="grid">
          <div class="tile easy" data-quest="Hand Dryer Instead of Paper Towel" data-xp="+50 XP">
            <div style="display:flex;justify-content:space-between;align-items:flex-start">
              <div class="icon"><span class="material-symbols-outlined">dry</span></div>
              <span class="pill">EASY</span>
            </div>
            <div>
              <h4>Hand Dryer Instead of Paper Towel</h4>
              <p>Public restroom</p>
            </div>
            <div class="rp"><span class="material-icons-round" style="font-size:14px;">stars</span> +50 XP</div>
          </div>

          <div class="tile med" data-quest="Litter Pickup" data-xp="+90 XP">
            <div style="display:flex;justify-content:space-between;align-items:flex-start">
              <div class="icon"><span class="material-symbols-outlined">delete</span></div>
              <span class="pill">MEDIUM</span>
            </div>
            <div>
              <h4>Litter Pickup</h4>
              <p>Street / park / sidewalk</p>
            </div>
            <div class="rp"><span class="material-icons-round" style="font-size:14px;">stars</span> +90 XP</div>
          </div>

          <div class="tile amber" data-quest="Recycling" data-xp="+80 XP">
            <div style="display:flex;justify-content:space-between;align-items:flex-start">
              <div class="icon"><span class="material-icons-round">recycling</span></div>
              <span class="pill">MEDIUM</span>
            </div>
            <div>
              <h4>Recycling</h4>
              <p>Public recycling bin / <br> home sorting area</p>
            </div>
            <div class="rp"><span class="material-icons-round" style="font-size:14px;">stars</span> +80 XP</div>
          </div>

          <div class="tile purple" data-quest="Reusable Shopping Bag" data-xp="+30 XP">
            <div style="display:flex;justify-content:space-between;align-items:flex-start">
              <div class="icon"><span class="material-symbols-outlined">local_mall</span></div>
              <span class="pill">EASY</span>
            </div>
            <div>
              <h4>Reusable Shopping Bag</h4>
              <p>Grocery store / market</p>
            </div>
            <div class="rp"><span class="material-icons-round" style="font-size:14px;">stars</span> +30 XP</div>
          </div>

          <div class="tile locked">
            <div class="lock"><span class="material-icons-round">lock</span></div>
            <div class="icon"><span class="material-icons-round">terrain</span></div>
            <div>
              <h4>Refill Instead of Buying New</h4>
              <p style="color:#b42318;font-weight:700;">Requires LVL 15</p>
            </div>
          </div>

          <div class="tile empty">
            <div>
              <span class="material-icons-round" style="font-size:28px;">hourglass_empty</span>
              <div style="font-size:10px;font-weight:700;margin-top:4px;">Restocking Board…</div>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <nav>
    <div class="bar">
      <a href="progress.html" aria-label="Progress">
        <button aria-label="Progress">
          <span class='material-symbols-outlined'>analytics</span>
        </button>
      </a>

      <a href="camera_final.html" aria-label="Camera">
        <button aria-label="Camera">
          <div class='fab'><span class='material-icons-round' style='font-size:28px;'>photo_camera</span></div>
        </button>
      </a>

      <a href="leaderboard_nav3.html" aria-label="Leaderboard">
        <button aria-label="Leaderboard">
          <span class='material-icons-round'>emoji_events</span>
        </button>
      </a>
    </div>
  </nav>

  <!-- Before/After Proof overlay + bottom sheet -->
  <div class="overlay" id="proofOverlay" aria-hidden="true"></div>

  <section class="sheet" id="proofSheet" aria-hidden="true">
    <div class="top">
      <div>
        <h3 id="proofTitle">Submit Before/After</h3>
        <div class="sub" id="proofMeta">Take or upload two photos: <b>Before</b> and <b>After</b>.</div>
      </div>
      <button class="close" id="proofClose" aria-label="Close">
        <span class="material-icons-round">close</span>
      </button>
    </div>

    <div class="frame">
      <video id="proofVideo" autoplay playsinline muted></video>
    </div>

    <div class="slots">
      <!-- BEFORE -->
      <div class="slot" id="slotBefore">
        <div class="label">
          <strong>Before</strong>
          <span class="status" id="beforeStatus">Not set</span>
        </div>
        <div class="thumb">
          <img id="beforeImg" alt="Before photo"/>
          <div class="ph" id="beforePh">No photo</div>
        </div>
        <div class="actionsRow">
          <button class="ghost" type="button" id="beforeUploadBtn" aria-label="Upload before photo">
            <span class="material-icons-round" style="font-size:18px;">upload</span>
          </button>
          <button class="primary" type="button" id="beforeCaptureBtn" aria-label="Capture before photo">
            <span class="material-icons-round" style="font-size:18px;">photo_camera</span>
          </button>
        </div>
      </div>

      <!-- AFTER -->
      <div class="slot" id="slotAfter">
        <div class="label">
          <strong>After</strong>
          <span class="status" id="afterStatus">Not set</span>
        </div>
        <div class="thumb">
          <img id="afterImg" alt="After photo"/>
          <div class="ph" id="afterPh">No photo</div>
        </div>
        <div class="actionsRow">
          <button class="ghost" type="button" id="afterUploadBtn" aria-label="Upload after photo">
            <span class="material-icons-round" style="font-size:18px;">upload</span>
          </button>
          <button class="primary" type="button" id="afterCaptureBtn" aria-label="Capture after photo">
            <span class="material-icons-round" style="font-size:18px;">photo_camera</span>
          </button>
        </div>
      </div>
    </div>

    <div class="submitRow">
      <button class="ghost" type="button" id="resetBothBtn">Reset</button>
      <button class="primary" type="button" id="submitBothBtn" disabled>Submit</button>
    </div>

    <div class="hint" id="proofHint">
      Submit becomes available after you add both <b>Before</b> and <b>After</b>.
    </div>
    <div class="toast" id="proofToast">Submitted! (+XP applied in demo)</div>

    <input id="beforeFile" type="file" accept="image/*" capture="environment" />
    <input id="afterFile" type="file" accept="image/*" capture="environment" />
  </section>

<script>
(function(){
  const overlay = document.getElementById('proofOverlay');
  const sheet = document.getElementById('proofSheet');
  const closeBtn = document.getElementById('proofClose');

  const titleEl = document.getElementById('proofTitle');
  const metaEl  = document.getElementById('proofMeta');

  const videoEl = document.getElementById('proofVideo');

  const beforeStatus = document.getElementById('beforeStatus');
  const afterStatus = document.getElementById('afterStatus');
  const beforeImg = document.getElementById('beforeImg');
  const afterImg = document.getElementById('afterImg');
  const beforePh = document.getElementById('beforePh');
  const afterPh = document.getElementById('afterPh');

  const beforeUploadBtn = document.getElementById('beforeUploadBtn');
  const afterUploadBtn = document.getElementById('afterUploadBtn');
  const beforeCaptureBtn = document.getElementById('beforeCaptureBtn');
  const afterCaptureBtn = document.getElementById('afterCaptureBtn');

  const resetBothBtn = document.getElementById('resetBothBtn');
  const submitBothBtn = document.getElementById('submitBothBtn');
  const hintEl = document.getElementById('proofHint');
  const toastEl = document.getElementById('proofToast');

  const beforeFile = document.getElementById('beforeFile');
  const afterFile = document.getElementById('afterFile');

  let stream = null;
  let currentQuest = { name:'', xp:'' };

  let beforeBlob = null;
  let afterBlob = null;

  function updateSubmitState(){
    const ok = !!beforeBlob && !!afterBlob;
    submitBothBtn.disabled = !ok;
    hintEl.innerHTML = ok
      ? 'Ready. Click <b>Submit</b> to send both photos.'
      : 'Submit becomes available after you add both <b>Before</b> and <b>After</b>.';
  }

  function setSlot(which, blob){
    const url = URL.createObjectURL(blob);
    if(which === 'before'){
      beforeBlob = blob;
      beforeImg.src = url;
      beforeImg.style.display = 'block';
      beforePh.style.display = 'none';
      beforeStatus.textContent = 'Added';
      beforeStatus.classList.add('ok');
    }else{
      afterBlob = blob;
      afterImg.src = url;
      afterImg.style.display = 'block';
      afterPh.style.display = 'none';
      afterStatus.textContent = 'Added';
      afterStatus.classList.add('ok');
    }
    updateSubmitState();
  }

  async function startCamera(){
    try{
      if(stream) return;
      stream = await navigator.mediaDevices.getUserMedia({
        video: { facingMode: 'environment' },
        audio: false
      });
      videoEl.srcObject = stream;
    }catch(err){
      stream = null;
      // Hide video if camera unavailable
      videoEl.style.display = 'none';
      hintEl.textContent = 'Camera unavailable. Use Upload to attach before/after photos instead.';
    }
  }

  function stopCamera(){
    if(stream){
      stream.getTracks().forEach(t => t.stop());
      stream = null;
    }
    videoEl.srcObject = null;
    videoEl.style.display = 'block';
  }

  function resetAll(){
    beforeBlob = null; afterBlob = null;
    beforeImg.src = ''; afterImg.src = '';
    beforeImg.style.display = 'none';
    afterImg.style.display = 'none';
    beforePh.style.display = 'block';
    afterPh.style.display = 'block';

    beforeStatus.textContent = 'Not set';
    afterStatus.textContent = 'Not set';
    beforeStatus.classList.remove('ok');
    afterStatus.classList.remove('ok');

    beforeFile.value = '';
    afterFile.value = '';
    toastEl.classList.remove('show');
    updateSubmitState();
  }

  function openProof({name, xp}){
    currentQuest.name = name || 'Submit Before/After';
    currentQuest.xp = xp || '';
    titleEl.textContent = currentQuest.name;
    metaEl.textContent = currentQuest.xp ? ('Reward: ' + currentQuest.xp + ' • Submit Before & After photos') : 'Submit Before & After photos';
    overlay.classList.add('show');
    sheet.classList.add('show');
    overlay.setAttribute('aria-hidden','false');
    sheet.setAttribute('aria-hidden','false');
    toastEl.classList.remove('show');
    resetAll();
    startCamera();
  }

  function closeProof(){
    overlay.classList.remove('show');
    sheet.classList.remove('show');
    overlay.setAttribute('aria-hidden','true');
    sheet.setAttribute('aria-hidden','true');
    stopCamera();
  }

  function captureSnapshot(){
    if(!stream) return null;
    const canvas = document.createElement('canvas');
    const w = videoEl.videoWidth || 1280;
    const h = videoEl.videoHeight || 720;
    canvas.width = w;
    canvas.height = h;
    const ctx = canvas.getContext('2d');
    ctx.drawImage(videoEl, 0, 0, w, h);
    return new Promise(resolve => {
      canvas.toBlob((blob) => resolve(blob), 'image/jpeg', 0.92);
    });
  }

  // Bind UI open triggers
  const acceptBtn = document.getElementById('acceptQuest');
  if(acceptBtn){
    acceptBtn.addEventListener('click', () => {
      const name = document.querySelector('.featured h3')?.textContent?.trim();
      const xp = document.querySelector('.featured .reward')?.textContent?.trim().replace(/\s+/g,' ');
      openProof({name, xp});
    });
  }

  document.querySelectorAll('.tile').forEach(tile => {
    if(tile.classList.contains('locked') || tile.classList.contains('empty')) return;
    tile.style.cursor = 'pointer';
    tile.addEventListener('click', () => {
      const name = tile.querySelector('h4')?.textContent?.trim();
      const xp = tile.querySelector('.rp')?.textContent?.trim().replace(/\s+/g,' ');
      openProof({name, xp});
    });
  });

  document.getElementById('navCamera')?.addEventListener('click', () => {
    openProof({name:'Camera', xp:''});
  });

  overlay.addEventListener('click', closeProof);
  closeBtn.addEventListener('click', closeProof);
  document.addEventListener('keydown', (e) => {
    if(e.key === 'Escape' && overlay.classList.contains('show')) closeProof();
  });

  // Upload buttons
  beforeUploadBtn.addEventListener('click', () => beforeFile.click());
  afterUploadBtn.addEventListener('click', () => afterFile.click());

  beforeFile.addEventListener('change', () => {
    const f = beforeFile.files && beforeFile.files[0];
    if(!f) return;
    setSlot('before', f);
  });
  afterFile.addEventListener('change', () => {
    const f = afterFile.files && afterFile.files[0];
    if(!f) return;
    setSlot('after', f);
  });

  // Capture buttons
  beforeCaptureBtn.addEventListener('click', async () => {
    const blob = await captureSnapshot();
    if(!blob){
      beforeFile.click();
      return;
    }
    setSlot('before', blob);
  });

  afterCaptureBtn.addEventListener('click', async () => {
    const blob = await captureSnapshot();
    if(!blob){
      afterFile.click();
      return;
    }
    setSlot('after', blob);
  });

  resetBothBtn.addEventListener('click', resetAll);

  submitBothBtn.addEventListener('click', () => {
    if(!beforeBlob || !afterBlob) return;
    // demo: show toast and keep sheet open
    toastEl.textContent = `Submitted! ${currentQuest.xp ? '(' + currentQuest.xp + ')' : ''}`;
    toastEl.classList.add('show');
  });

  // init
  updateSubmitState();
})();
</script>

</body>
</html>
